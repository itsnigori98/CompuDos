


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > AdminController</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">edu.icesi.fitness.controller</a>
</div>

<h1>Coverage Summary for Class: AdminController (edu.icesi.fitness.controller)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">AdminController</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/40)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/42)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/94)
  </span>
</td>
</tr>
  <tr>
    <td class="name">AdminController$CreateUserDto</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdminController$EventUpsertDto</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdminController$ExerciseUpsertDto</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdminController$RoleCreateDto</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdminController$RolePermissionsDto</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdminController$UpdateUserDto</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/46)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/42)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/100)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package edu.icesi.fitness.controller;
&nbsp;
&nbsp;import com.fasterxml.jackson.annotation.JsonFormat;
&nbsp;import edu.icesi.fitness.model.Event;
&nbsp;import edu.icesi.fitness.model.Exercise;
&nbsp;import edu.icesi.fitness.model.Notification;
&nbsp;import edu.icesi.fitness.model.User;
&nbsp;import edu.icesi.fitness.repository.EventRepository;
&nbsp;import edu.icesi.fitness.repository.ExerciseRepository;
&nbsp;import edu.icesi.fitness.repository.NotificationRepository;
&nbsp;import edu.icesi.fitness.repository.PermissionRepository;
&nbsp;import edu.icesi.fitness.repository.ProgressRepository;
&nbsp;import edu.icesi.fitness.repository.RoleRepository;
&nbsp;import edu.icesi.fitness.repository.RoutineRepository;
&nbsp;import edu.icesi.fitness.repository.TrainerRepository;
&nbsp;import edu.icesi.fitness.repository.UserRepository;
&nbsp;import edu.icesi.fitness.service.PermissionService;
&nbsp;import edu.icesi.fitness.service.RoleService;
&nbsp;import edu.icesi.fitness.service.UserService;
&nbsp;import org.springframework.beans.factory.annotation.Autowired;
&nbsp;import org.springframework.http.HttpStatus;
&nbsp;import org.springframework.http.ResponseEntity;
&nbsp;import org.springframework.web.bind.annotation.*;
&nbsp;import org.springframework.web.server.ResponseStatusException;
&nbsp;
&nbsp;import java.util.*;
&nbsp;
&nbsp;@RestController
&nbsp;@RequestMapping(&quot;/api/admin&quot;)
<b class="nc">&nbsp;public class AdminController {</b>
&nbsp;
&nbsp;    // ======== Services (idempotentes) ========
&nbsp;    @Autowired private UserService userService;
&nbsp;    @Autowired private RoleService roleService;
&nbsp;    @Autowired private PermissionService permissionService;
&nbsp;
&nbsp;    // ======== Repositories para queries y catálogos ========
&nbsp;    @Autowired private UserRepository userRepository;
&nbsp;    @Autowired private RoleRepository roleRepository;
&nbsp;    @Autowired private PermissionRepository permissionRepository;
&nbsp;    @Autowired private RoutineRepository routineRepository;
&nbsp;    @Autowired private ExerciseRepository exerciseRepository;
&nbsp;    @Autowired private ProgressRepository progressRepository;
&nbsp;    @Autowired private NotificationRepository notificationRepository;
&nbsp;    @Autowired private TrainerRepository trainerRepository;
&nbsp;    @Autowired private EventRepository eventRepository;
&nbsp;
&nbsp;    // ------------------------------------------------
&nbsp;    //                  QUERIES (TALLER)
&nbsp;    // ------------------------------------------------
&nbsp;
&nbsp;    // ejercicio1: usuarios por rol &quot;ROLE_USER&quot;
&nbsp;    @GetMapping(&quot;ejercicio1&quot;)
&nbsp;    public ResponseEntity&lt;?&gt; ejercicio1() {
<b class="nc">&nbsp;        var output = userRepository.findByRoles_NameOrderByIdAsc(&quot;ROLE_USER&quot;);</b>
<b class="nc">&nbsp;        return ResponseEntity.ok(output);</b>
&nbsp;    }
&nbsp;
&nbsp;    // ejercicio2: rutinas del usuario id=1
&nbsp;    @GetMapping(&quot;ejercicio2&quot;)
&nbsp;    public ResponseEntity&lt;?&gt; ejercicio2() {
<b class="nc">&nbsp;        var output = routineRepository.findByUsers_IdOrderByIdAsc(1);</b>
<b class="nc">&nbsp;        return ResponseEntity.ok(output);</b>
&nbsp;    }
&nbsp;
&nbsp;    // ejercicio3: último progreso del usuario id=2 (ordenado por fecha desc)
&nbsp;    @GetMapping(&quot;ejercicio3&quot;)
&nbsp;    public ResponseEntity&lt;?&gt; ejercicio3() {
<b class="nc">&nbsp;        var output = progressRepository.findTopByUser_IdOrderByDateDesc(2).orElse(null);</b>
<b class="nc">&nbsp;        return ResponseEntity.ok(output);</b>
&nbsp;    }
&nbsp;
&nbsp;    // ejercicio4: ejercicios cuyo nombre contiene &quot;press&quot;
&nbsp;    @GetMapping(&quot;ejercicio4&quot;)
&nbsp;    public ResponseEntity&lt;?&gt; ejercicio4() {
<b class="nc">&nbsp;        var output = exerciseRepository.findByNameContainingIgnoreCaseOrderByIdAsc(&quot;press&quot;);</b>
<b class="nc">&nbsp;        return ResponseEntity.ok(output);</b>
&nbsp;    }
&nbsp;
&nbsp;    // ejercicio5: notificaciones del usuario id=1
&nbsp;    @GetMapping(&quot;ejercicio5&quot;)
&nbsp;    public ResponseEntity&lt;?&gt; ejercicio5() {
<b class="nc">&nbsp;        var output = notificationRepository.findByUsers_IdOrderByIdAsc(1);</b>
<b class="nc">&nbsp;        return ResponseEntity.ok(output);</b>
&nbsp;    }
&nbsp;
&nbsp;    // ejercicio6: próximos eventos (desde ahora)
&nbsp;    @GetMapping(&quot;ejercicio6&quot;)
&nbsp;    public ResponseEntity&lt;?&gt; ejercicio6() {
<b class="nc">&nbsp;        var output = eventRepository.findByDateAfterOrderByDateAsc(new Date());</b>
<b class="nc">&nbsp;        return ResponseEntity.ok(output);</b>
&nbsp;    }
&nbsp;
&nbsp;    // ejercicio7: eventos en los que participa el usuario id=2
&nbsp;    @GetMapping(&quot;ejercicio7&quot;)
&nbsp;    public ResponseEntity&lt;?&gt; ejercicio7() {
<b class="nc">&nbsp;        var output = eventRepository.findByUsers_IdOrderByDateAsc(2);</b>
<b class="nc">&nbsp;        return ResponseEntity.ok(output);</b>
&nbsp;    }
&nbsp;
&nbsp;    // ejercicio8: usuarios por rango de edad 18..30
&nbsp;    @GetMapping(&quot;ejercicio8&quot;)
&nbsp;    public ResponseEntity&lt;?&gt; ejercicio8() {
<b class="nc">&nbsp;        var output = userRepository.findByAgeBetweenOrderByAgeAsc(18, 30);</b>
<b class="nc">&nbsp;        return ResponseEntity.ok(output);</b>
&nbsp;    }
&nbsp;
&nbsp;    // ejercicio9: trainers por especialidad que contenga &quot;Bici&quot;
&nbsp;    @GetMapping(&quot;ejercicio9&quot;)
&nbsp;    public ResponseEntity&lt;?&gt; ejercicio9() {
<b class="nc">&nbsp;        var output = trainerRepository.findBySpecialtyContainingIgnoreCaseOrderByIdAsc(&quot;Bici&quot;);</b>
<b class="nc">&nbsp;        return ResponseEntity.ok(output);</b>
&nbsp;    }
&nbsp;
&nbsp;    // ejercicio10: eventos ligados a la notificación id=1
&nbsp;    @GetMapping(&quot;ejercicio10&quot;)
&nbsp;    public ResponseEntity&lt;?&gt; ejercicio10() {
<b class="nc">&nbsp;        var output = eventRepository.findByNotificationId_IdOrderByDateAsc(1);</b>
<b class="nc">&nbsp;        return ResponseEntity.ok(output);</b>
&nbsp;    }
&nbsp;
&nbsp;    // ------------------------------------------------
&nbsp;    //                    USERS (Admin)
&nbsp;    // ------------------------------------------------
<b class="nc">&nbsp;    public static class CreateUserDto {</b>
&nbsp;        public String name;
&nbsp;        public String email;
&nbsp;        public String password;
&nbsp;        public Set&lt;String&gt; roles; // opcional: extra roles además de ROLE_USER
&nbsp;    }
<b class="nc">&nbsp;    public static class UpdateUserDto {</b>
&nbsp;        public String name;
&nbsp;        public String email;
&nbsp;        public String password;
&nbsp;    }
&nbsp;
&nbsp;    @GetMapping(&quot;/users&quot;)
&nbsp;    public ResponseEntity&lt;List&lt;User&gt;&gt; listUsers() {
<b class="nc">&nbsp;        return ResponseEntity.ok(userService.listAll());</b>
&nbsp;    }
&nbsp;
&nbsp;    @GetMapping(&quot;/users/{id}&quot;)
&nbsp;    public ResponseEntity&lt;User&gt; getUser(@PathVariable Long id) {
<b class="nc">&nbsp;        return ResponseEntity.ok(userService.getById(id));</b>
&nbsp;    }
&nbsp;
&nbsp;    @PostMapping(value = &quot;/users&quot;, consumes = &quot;application/json&quot;)
&nbsp;    public ResponseEntity&lt;User&gt; createUser(@RequestBody CreateUserDto dto) {
<b class="nc">&nbsp;        User u = userService.createUser(dto.name, dto.email, dto.password, dto.roles);</b>
<b class="nc">&nbsp;        return new ResponseEntity&lt;&gt;(u, HttpStatus.CREATED);</b>
&nbsp;    }
&nbsp;
&nbsp;    @PutMapping(value = &quot;/users/{id}&quot;, consumes = &quot;application/json&quot;)
&nbsp;    public ResponseEntity&lt;User&gt; updateUser(@PathVariable Integer id, @RequestBody UpdateUserDto dto) {
<b class="nc">&nbsp;        User u = userService.updateBasicInfo(id, dto.name, dto.email, dto.password);</b>
<b class="nc">&nbsp;        return ResponseEntity.ok(u);</b>
&nbsp;    }
&nbsp;
&nbsp;    @PutMapping(value = &quot;/users/{id}/roles&quot;, consumes = &quot;application/json&quot;)
&nbsp;    public ResponseEntity&lt;User&gt; setUserRoles(@PathVariable Integer id, @RequestBody Set&lt;String&gt; roleNames) {
<b class="nc">&nbsp;        return ResponseEntity.ok(userService.setRoles(id, roleNames));</b>
&nbsp;    }
&nbsp;
&nbsp;    @PostMapping(&quot;/users/{id}/roles/{roleName}&quot;)
&nbsp;    public ResponseEntity&lt;User&gt; addRoleToUser(@PathVariable Integer id, @PathVariable String roleName) {
<b class="nc">&nbsp;        return ResponseEntity.ok(userService.addRole(id, roleName));</b>
&nbsp;    }
&nbsp;
&nbsp;    @DeleteMapping(&quot;/users/{id}/roles/{roleName}&quot;)
&nbsp;    public ResponseEntity&lt;User&gt; removeRoleFromUser(@PathVariable Integer id, @PathVariable String roleName) {
<b class="nc">&nbsp;        return ResponseEntity.ok(userService.removeRole(id, roleName));</b>
&nbsp;    }
&nbsp;
&nbsp;    @DeleteMapping(&quot;/users/{id}&quot;)
&nbsp;    public ResponseEntity&lt;Void&gt; deleteUser(@PathVariable Integer id) {
<b class="nc">&nbsp;        userService.deleteUser(id);</b>
<b class="nc">&nbsp;        return ResponseEntity.noContent().build();</b>
&nbsp;    }
&nbsp;
&nbsp;    // ------------------------------------------------
&nbsp;    //                    ROLES (Admin)
&nbsp;    // ------------------------------------------------
<b class="nc">&nbsp;    public static class RoleCreateDto {</b>
&nbsp;        public String name;
&nbsp;        public Set&lt;String&gt; permissions; // opcional; &quot;app:view&quot; se agrega siempre
&nbsp;    }
<b class="nc">&nbsp;    public static class RolePermissionsDto {</b>
&nbsp;        public Set&lt;String&gt; permissions;
&nbsp;    }
&nbsp;
&nbsp;    @GetMapping(&quot;/roles&quot;)
&nbsp;    public ResponseEntity&lt;?&gt; listRoles() {
<b class="nc">&nbsp;        return ResponseEntity.ok(roleService.listAll());</b>
&nbsp;    }
&nbsp;
&nbsp;    @GetMapping(&quot;/roles/{name}&quot;)
&nbsp;    public ResponseEntity&lt;?&gt; getRole(@PathVariable String name) {
<b class="nc">&nbsp;        return ResponseEntity.ok(roleService.getByName(name));</b>
&nbsp;    }
&nbsp;
&nbsp;    @PostMapping(value = &quot;/roles&quot;, consumes = &quot;application/json&quot;)
&nbsp;    public ResponseEntity&lt;?&gt; createRole(@RequestBody RoleCreateDto dto) {
<b class="nc">&nbsp;        if (dto == null || dto.name == null || dto.name.isBlank()) {</b>
<b class="nc">&nbsp;            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, &quot;Role name is required&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        return new ResponseEntity&lt;&gt;(roleService.createRole(dto.name, dto.permissions), HttpStatus.CREATED);</b>
&nbsp;    }
&nbsp;
&nbsp;    @PutMapping(value = &quot;/roles/{name}/permissions&quot;, consumes = &quot;application/json&quot;)
&nbsp;    public ResponseEntity&lt;?&gt; setRolePermissions(@PathVariable String name, @RequestBody RolePermissionsDto body) {
<b class="nc">&nbsp;        Set&lt;String&gt; perms = (body == null ? Collections.emptySet() : body.permissions);</b>
<b class="nc">&nbsp;        return ResponseEntity.ok(roleService.setPermissions(name, perms));</b>
&nbsp;    }
&nbsp;
&nbsp;    @PostMapping(&quot;/roles/{name}/permissions/{permissionName}&quot;)
&nbsp;    public ResponseEntity&lt;?&gt; addPermissionToRole(@PathVariable String name, @PathVariable String permissionName) {
<b class="nc">&nbsp;        return ResponseEntity.ok(roleService.addPermission(name, permissionName));</b>
&nbsp;    }
&nbsp;
&nbsp;    @DeleteMapping(&quot;/roles/{name}/permissions/{permissionName}&quot;)
&nbsp;    public ResponseEntity&lt;?&gt; removePermissionFromRole(@PathVariable String name, @PathVariable String permissionName) {
<b class="nc">&nbsp;        return ResponseEntity.ok(roleService.removePermission(name, permissionName));</b>
&nbsp;    }
&nbsp;
&nbsp;    @DeleteMapping(&quot;/roles/{name}&quot;)
&nbsp;    public ResponseEntity&lt;Void&gt; deleteRole(@PathVariable String name) {
<b class="nc">&nbsp;        roleService.delete(name);</b>
<b class="nc">&nbsp;        return ResponseEntity.noContent().build();</b>
&nbsp;    }
&nbsp;
&nbsp;    // ------------------------------------------------
&nbsp;    //                 PERMISSIONS (Admin)
&nbsp;    // ------------------------------------------------
&nbsp;    @PostMapping(value = &quot;/permissions&quot;, consumes = &quot;application/json&quot;)
&nbsp;    public ResponseEntity&lt;?&gt; createPermission(@RequestBody String name) {
<b class="nc">&nbsp;        if (name == null || name.isBlank()) {</b>
<b class="nc">&nbsp;            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, &quot;Permission name is required&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        return new ResponseEntity&lt;&gt;(permissionService.create(name), HttpStatus.CREATED);</b>
&nbsp;    }
&nbsp;
&nbsp;    @GetMapping(&quot;/permissions&quot;)
&nbsp;    public ResponseEntity&lt;?&gt; listPermissions() {
<b class="nc">&nbsp;        return ResponseEntity.ok(permissionService.listAll());</b>
&nbsp;    }
&nbsp;
&nbsp;    @GetMapping(&quot;/permissions/{name}&quot;)
&nbsp;    public ResponseEntity&lt;?&gt; getPermission(@PathVariable String name) {
<b class="nc">&nbsp;        return ResponseEntity.ok(permissionService.getByName(name));</b>
&nbsp;    }
&nbsp;
&nbsp;    @DeleteMapping(&quot;/permissions/{name}&quot;)
&nbsp;    public ResponseEntity&lt;Void&gt; deletePermission(@PathVariable String name) {
<b class="nc">&nbsp;        permissionService.deleteByName(name);</b>
<b class="nc">&nbsp;        return ResponseEntity.noContent().build();</b>
&nbsp;    }
&nbsp;
&nbsp;    // ------------------------------------------------
&nbsp;//            EXERCISES (catálogo – Admin)
&nbsp;// ------------------------------------------------
<b class="nc">&nbsp;    public static class ExerciseUpsertDto {</b>
&nbsp;        public String name;
&nbsp;        public String type;
&nbsp;        public String description;
&nbsp;        public String videoUrl;
&nbsp;    }
&nbsp;
&nbsp;    @PostMapping(value = &quot;/exercises&quot;, consumes = &quot;application/json&quot;)
&nbsp;    public ResponseEntity&lt;Exercise&gt; createExercise(@RequestBody ExerciseUpsertDto dto) {
<b class="nc">&nbsp;        if (dto.name == null || dto.name.isBlank()) {</b>
<b class="nc">&nbsp;            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, &quot;Exercise.name is required&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        Exercise e = new Exercise();</b>
<b class="nc">&nbsp;        e.setName(dto.name);</b>
<b class="nc">&nbsp;        e.setType(dto.type);</b>
<b class="nc">&nbsp;        e.setDescription(dto.description);</b>
<b class="nc">&nbsp;        e.setVideoUrl(dto.videoUrl);</b>
<b class="nc">&nbsp;        return new ResponseEntity&lt;&gt;(exerciseRepository.save(e), HttpStatus.CREATED);</b>
&nbsp;    }
&nbsp;
&nbsp;    @PutMapping(value = &quot;/exercises/{id}&quot;, consumes = &quot;application/json&quot;)
&nbsp;    public ResponseEntity&lt;Exercise&gt; updateExercise(@PathVariable Long id, @RequestBody ExerciseUpsertDto dto) {
<b class="nc">&nbsp;        Exercise e = exerciseRepository.findById(id).orElseThrow(() -&gt;</b>
<b class="nc">&nbsp;                new ResponseStatusException(HttpStatus.NOT_FOUND, &quot;Exercise not found&quot;));</b>
&nbsp;
<b class="nc">&nbsp;        if (dto.name != null)        e.setName(dto.name);</b>
<b class="nc">&nbsp;        if (dto.type != null)        e.setType(dto.type);</b>
<b class="nc">&nbsp;        if (dto.description != null) e.setDescription(dto.description);</b>
<b class="nc">&nbsp;        if (dto.videoUrl != null)    e.setVideoUrl(dto.videoUrl);</b>
&nbsp;
<b class="nc">&nbsp;        return ResponseEntity.ok(exerciseRepository.save(e));</b>
&nbsp;    }
&nbsp;
&nbsp;    @DeleteMapping(&quot;/exercises/{id}&quot;)
&nbsp;    public ResponseEntity&lt;Void&gt; deleteExercise(@PathVariable Long id) {
<b class="nc">&nbsp;        if (!exerciseRepository.existsById(id)) {</b>
<b class="nc">&nbsp;            throw new ResponseStatusException(HttpStatus.NOT_FOUND, &quot;Exercise not found&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        exerciseRepository.deleteById(id);</b>
<b class="nc">&nbsp;        return ResponseEntity.noContent().build();</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;    // ------------------------------------------------
&nbsp;    //               EVENTS (catálogo – Admin)
&nbsp;    // ------------------------------------------------
<b class="nc">&nbsp;    public static class EventUpsertDto {</b>
&nbsp;        public String name;
&nbsp;        @JsonFormat(pattern = &quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;)
&nbsp;        public Date date;
&nbsp;        public Integer notificationId;
&nbsp;        public List&lt;Integer&gt; users; // si decides manejar participantes
&nbsp;    }
&nbsp;
&nbsp;    @PostMapping(value = &quot;/events&quot;, consumes = &quot;application/json&quot;)
&nbsp;    public ResponseEntity&lt;Event&gt; createEvent(@RequestBody EventUpsertDto dto) {
<b class="nc">&nbsp;        if (dto.name == null || dto.name.isBlank()) {</b>
<b class="nc">&nbsp;            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, &quot;Event.name is required&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (dto.date == null) {</b>
<b class="nc">&nbsp;            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, &quot;Event.date is required (ISO-8601)&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        Event ev = new Event();</b>
<b class="nc">&nbsp;        ev.setName(dto.name);</b>
<b class="nc">&nbsp;        ev.setDate(dto.date);</b>
&nbsp;
<b class="nc">&nbsp;        if (dto.notificationId != null) {</b>
<b class="nc">&nbsp;            Notification notif = notificationRepository.findById(dto.notificationId).orElseThrow(() -&gt;</b>
<b class="nc">&nbsp;                    new ResponseStatusException(HttpStatus.BAD_REQUEST, &quot;Notification not found: &quot; + dto.notificationId));</b>
<b class="nc">&nbsp;            ev.setNotificationId(notif);</b>
&nbsp;        }
<b class="nc">&nbsp;        return new ResponseEntity&lt;&gt;(eventRepository.save(ev), HttpStatus.CREATED);</b>
&nbsp;    }
&nbsp;
&nbsp;    @PutMapping(value = &quot;/events/{id}&quot;, consumes = &quot;application/json&quot;)
&nbsp;    public ResponseEntity&lt;Event&gt; updateEvent(@PathVariable Integer id, @RequestBody EventUpsertDto dto) {
<b class="nc">&nbsp;        Event ev = eventRepository.findById(id).orElseThrow(() -&gt;</b>
<b class="nc">&nbsp;                new ResponseStatusException(HttpStatus.NOT_FOUND, &quot;Event not found&quot;));</b>
<b class="nc">&nbsp;        if (dto.name != null) ev.setName(dto.name);</b>
<b class="nc">&nbsp;        if (dto.date != null) ev.setDate(dto.date);</b>
<b class="nc">&nbsp;        if (dto.notificationId != null) {</b>
<b class="nc">&nbsp;            Notification notif = notificationRepository.findById(dto.notificationId).orElseThrow(() -&gt;</b>
<b class="nc">&nbsp;                    new ResponseStatusException(HttpStatus.BAD_REQUEST, &quot;Notification not found: &quot; + dto.notificationId));</b>
<b class="nc">&nbsp;            ev.setNotificationId(notif);</b>
&nbsp;        }
<b class="nc">&nbsp;        return ResponseEntity.ok(eventRepository.save(ev));</b>
&nbsp;    }
&nbsp;
&nbsp;    @DeleteMapping(&quot;/events/{id}&quot;)
&nbsp;    public ResponseEntity&lt;Void&gt; deleteEvent(@PathVariable Integer id) {
<b class="nc">&nbsp;        if (!eventRepository.existsById(id)) {</b>
<b class="nc">&nbsp;            throw new ResponseStatusException(HttpStatus.NOT_FOUND, &quot;Event not found&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        eventRepository.deleteById(id);</b>
<b class="nc">&nbsp;        return ResponseEntity.noContent().build();</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-09-20 15:38</div>
</div>
</body>
</html>
